<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal PK ‚Äî Dashboard</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body data-role="admin">
    <header class="site-header">
      <div class="wrap">
        <h1>Portal PK ‚Äì Dashboard</h1>
        <!-- Search spraw (wstaw PRZED przyciskiem Wyloguj) -->
        <div
          id="caseSearchWrap"
          style="
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 12px;
          "
        >
          <div style="position: relative; display: flex; align-items: center">
            <input
              id="caseSearch"
              type="text"
              placeholder="Szukaj: nazwisko"
              autocomplete="off"
              style="
                height: 34px;
                padding: 0 28px 0 10px;
                border: 1px solid #d0d7de;
                border-radius: 8px;
                outline: none;
                min-width: 220px;
              "
            />
            <button
              id="clearCaseSearch"
              title="Wyczy≈õƒá"
              aria-label="Wyczy≈õƒá"
              style="
                position: absolute;
                right: 4px;
                height: 24px;
                width: 24px;
                border: none;
                background: transparent;
                cursor: pointer;
                font-size: 16px;
                line-height: 1;
              "
            >
              √ó
            </button>
          </div>
          <span
            id="caseSearchCount"
            style="font-size: 12px; color: #6c757d"
          ></span>
        </div>

        <button id="logoutBtn">üö™ Wyloguj</button>
      </div>
    </header>

    <main>
      <div
        id="filterBar"
        style="display: flex; gap: 8px; align-items: center; margin: 8px 0 12px"
      >
        <label>Status:</label>
        <select id="flt_status">
          <option value="">wszystkie</option>
          <option value="new">Nowe</option>
          <option value="in_progress">W toku</option>
          <option value="success">Analiza pozytywna</option>
          <option value="lost">Odrzucone</option>
        </select>
        <button id="flt_refresh">Od≈õwie≈º</button>
      </div>

      <!-- KPI -->
      <section id="kpiBar" class="kpi-bar">
        <div class="kpi-card" data-status="">
          <!-- Wszystkie -->
          <div class="kpi-label">Wszystkie sprawy</div>
          <div class="kpi-value" id="kpiAll">‚Äì</div>
        </div>
        <div class="kpi-card" data-status="new">
          <!-- Nowe -->
          <div class="kpi-label">Nowe</div>
          <div class="kpi-value" id="kpiNew">‚Äì</div>
        </div>
        <div class="kpi-card" data-status="success">
          <!-- Analiza pozytywna -->
          <div class="kpi-label">Analiza pozytywna</div>
          <div class="kpi-value" id="kpiPositive">‚Äì</div>
        </div>
        <div class="kpi-card" data-status="in_progress">
          <!-- W toku -->
          <div class="kpi-label">W toku</div>
          <div class="kpi-value" id="kpiInProgress">‚Äì</div>
        </div>
        <div class="kpi-card" data-status="lost">
          <!-- Odrzucone -->
          <div class="kpi-label">Odrzucone</div>
          <div class="kpi-value" id="kpiRejected">‚Äì</div>
        </div>
      </section>

      <section id="kpiWpsBar" class="kpi-bar" style="margin-top: 12px">
        <div class="kpi-card">
          <div class="kpi-label">Suma WPS (wszystkie) (PLN)</div>
          <div class="kpi-value" id="kpiWpsTotal">‚Äì</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Suma WPS (w toku) (PLN)</div>
          <div class="kpi-value" id="kpiWpsInProgress">‚Äì</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">≈ör. WPS na sprawƒô (w toku) (PLN)</div>
          <div class="kpi-value" id="kpiWpsAvgInProgress">‚Äì</div>
        </div>
      </section>

      <!-- Layout 2 kolumny -->
      <div class="layout">
        <aside class="col-left">
          <table id="caseTable">
            <thead>
              <tr>
                <th>Klient</th>
                <th>Bank</th>
                <th>Kwota kredytu</th>
                <th>WPS</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="caseTableBody"></tbody>
          </table>
        </aside>

        <section class="col-right">
          <div class="card form-card">
            <h3 class="card-title">Dodaj nowƒÖ sprawƒô</h3>
            <div class="form-grid">
              <div class="field">
                <label for="addClient"><span>Klient</span></label>
                <input
                  id="addClient"
                  type="text"
                  placeholder="np. Jan Kowalski"
                />
              </div>
              <div class="field">
                <label for="addAmount"><span>Kwota (PLN)</span></label>
                <input
                  id="addAmount"
                  type="number"
                  min="0"
                  step="0.01"
                  placeholder="np. 25 000"
                />
              </div>
              <div class="field">
                <label for="addBank"><span>Bank</span></label>
                <select id="addBank"></select>
              </div>
            </div>
            <input id="addStatus" type="hidden" value="nowa" />
            <div class="form-actions">
              <button id="addCaseBtn" type="button">Zapisz sprawƒô</button>
            </div>
          </div>
        </section>
      </div>

      <!-- === MODAL: Edycja sprawy (estetyczny) === -->
      <div
        id="caseModal"
        class="modal modal-modern"
        style="display: none"
        role="dialog"
        aria-modal="true"
        aria-labelledby="cmTitle"
      >
        <div class="modal-backdrop"></div>
        <div class="modal-card modal-sheet">
          <div class="modal-header">
            <div class="title">
              <span>Sprawa:</span>
              <span id="cmClient">‚Äî</span>
              <span id="cmStatusBadge" class="badge">‚Äî</span>
            </div>
            <div style="display: flex; gap: 8px; align-items: center">
              <button id="cmClose" aria-label="Zamknij" class="btn">√ó</button>
            </div>
          </div>

          <div class="modal-tabs">
            <div class="tab active" data-tab="info">Podsumowanie</div>
            <div class="tab" data-tab="edit">Edycja</div>
            <div class="tab" data-tab="offers">Produkty/Us≈Çugi</div>
          </div>
          <!-- ===== OFERTA SKD (sekcja) ===== -->
          <section id="skdOffer" class="card">
            <header class="card-h">
              <div>
                <div class="card-title">Oferta SKD</div>
                <div id="skdOfferSub" class="card-sub">‚Äî</div>
              </div>
              <button
                id="skdOfferSaveBtn"
                class="btn btn-primary"
                style="display: none"
              >
                Zapisz
              </button>
            </header>

            <div class="card-b">
              <!-- === DOSTƒòPNO≈öƒÜ WARIANT√ìW (tylko dla admina) === -->
              <div class="group" id="skdEligibilityGroup">
                <div class="group-title">
                  Dostƒôpno≈õƒá wariant√≥w (co mo≈ºemy zaproponowaƒá)
                </div>
                <div class="row">
                  <label class="chk">
                    <input type="checkbox" id="eligSf50" checked />
                    <span>Success Fee 50% ‚Äî bez ryzyka</span>
                  </label>
                  <label class="chk">
                    <input type="checkbox" id="eligSf49" checked />
                    <span>Success Fee 49% ‚Äî z wynagrodzeniem poczƒÖtkowym</span>
                  </label>
                  <label class="chk">
                    <input type="checkbox" id="eligSell" checked />
                    <span>Sprzeda≈º roszczenia ‚Äî wyp≈Çata z g√≥ry</span>
                  </label>
                </div>
                <small
                  >Odznacz warianty, kt√≥re nie sƒÖ mo≈ºliwe dla tej sprawy.</small
                >
              </div>

              <!-- === PREFERENCJA KLIENTA (tylko dla partnera) === -->
              <div class="group" id="clientPreferenceBlock">
                <div class="group-title">Preferencja Klienta</div>
                <label class="radio">
                  <input type="radio" name="clientPref" value="sf50" />
                  <div><b>Success Fee 50%</b> ‚Äî bez ryzyka dla Klienta</div>
                </label>
                <label class="radio">
                  <input type="radio" name="clientPref" value="sf49" />
                  <div>
                    <b>Success Fee 49%</b> ‚Äî z wynagrodzeniem poczƒÖtkowym
                  </div>
                </label>
                <label class="radio">
                  <input type="radio" name="clientPref" value="sell" />
                  <div><b>Sprzeda≈º roszczenia</b> ‚Äî wyp≈Çata z g√≥ry</div>
                </label>
                <small
                  >Wybierz, kt√≥rƒÖ opcjƒÖ klient jest najbardziej
                  zainteresowany.</small
                >
              </div>

              <div class="grid2">
                <div class="group">
                  <div class="group-title">WPS prognoza</div>
                  <div class="row">
                    <label class="fld">
                      <span>Kwota (PLN)</span>
                      <input
                        id="wpsForecastInput"
                        type="number"
                        step="0.01"
                        min="0"
                        placeholder="np. 18 500,00"
                      />
                    </label>
                    <!-- (opcjonalnie) szybkie ustawienie z pola WPS w podsumowaniu, je≈õli jest w DOM -->
                    <button
                      id="btnCopyWpsToForecast"
                      class="btn"
                      title="Przepisz z WPS"
                    >
                      U≈ºyj warto≈õci z WPS
                    </button>
                  </div>
                </div>

                <div class="group" id="skdVariantAdminGroup">
                  <div class="group-title">Wariant oferty</div>

                  <label class="radio" data-variant="sf50">
                    <input type="radio" name="skdVariant" value="sf50" />
                    <div>
                      <div>
                        <b>Op≈Çata za sukces 50/50</b> ‚Äî bez ryzyka dla Klienta
                      </div>
                      <small
                        >Rozliczenie 50/50 od WPS. Anulowanie przysz≈Çych odsetek
                        dla Klienta
                      </small>
                    </div>
                  </label>

                  <label class="radio" data-variant="sf49">
                    <input type="radio" name="skdVariant" value="sf49" />
                    <div>
                      <div>
                        <b>Wariant Zlecenie 49/51</b> ‚Äî ryzyko po stronie
                        Klienta.
                      </div>
                      <small
                        >Wynagrodzenie wstƒôpne dla po≈õrednika za zawarcie umowy.
                        Anulowanie przysz≈Çych odsetek dla Klienta</small
                      >
                    </div>
                  </label>

                  <label class="radio" data-variant="sell">
                    <input type="radio" name="skdVariant" value="sell" />
                    <div>
                      <div><b>Sprzeda≈º roszczenia</b> ‚Äî ≈õrodki z g√≥ry</div>
                      <small
                        >Ustalony procent od WPS. Wyp≈Çata dla Klienta do 14 dni.
                        Anulowanie przysz≈Çych odsetek dla Klienta</small
                      >
                      <div class="row" data-extra="sell">
                        <label class="fld">
                          <span>Minimalna stawka dla Klienta (%)</span>
                          <input
                            id="buyoutPctInput"
                            type="number"
                            step="0.1"
                            min="0"
                            max="100"
                            value="10"
                          />
                        </label>
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <div class="group">
                <div class="group-title">Symulacja wyp≈Çat (szacunek)</div>
                <div class="est">
                  <div>
                    <span>‚ÄûTeraz‚Äù (z g√≥ry):</span><strong id="estNow">‚Äî</strong>
                  </div>
                  <div>
                    <span>‚ÄûP√≥≈∫niej‚Äù (po odzyskaniu):</span
                    ><strong id="estLater">‚Äî</strong>
                  </div>
                  <div>
                    <span>Suma dla Klienta:</span
                    ><strong id="estTotal">‚Äî</strong>
                  </div>
                </div>
                <small
                  >Warto≈õci orientacyjne ‚Äî WPS traktujemy jako bazƒô do
                  rozlicze≈Ñ.</small
                >
              </div>

              <div class="group">
                <div class="group-title">Notatka (wewnƒôtrzna)</div>
                <textarea
                  id="skdOfferNotes"
                  rows="3"
                  placeholder="np. klient preferuje sprzeda≈º roszczenia; mo≈ºliwa korekta % przy wykupie."
                ></textarea>
              </div>
            </div>
          </section>
          <!-- ===== /OFERTA SKD ===== -->

          <div class="modal-body">
            <!-- INFO -->
            <div class="tabpanel active" data-panel="info">
              <div class="grid">
                <div class="section">
                  <div class="kv">
                    <div class="item">
                      <div class="lbl">Klient</div>
                      <div class="val" id="cmInfoClient">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">Bank</div>
                      <div class="val" id="cmInfoBank">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">Kwota kredytu</div>
                      <div class="val" id="cmInfoAmount">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">WPS</div>
                      <div class="val" id="cmInfoWps">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">Status</div>
                      <div class="val" id="cmInfoStatus">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">Data zawarcia</div>
                      <div class="val" id="cmInfoDate">‚Äî</div>
                    </div>
                  </div>
                </div>
                <div class="section">
                  <div style="font-weight: 700; margin-bottom: 8px">
                    Dane kontaktowe
                  </div>
                  <div class="kv">
                    <div class="item">
                      <div class="lbl">Telefon</div>
                      <div class="val" id="cmInfoPhone">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">E-mail</div>
                      <div class="val" id="cmInfoEmail">‚Äî</div>
                    </div>
                    <div class="item" style="grid-column: 1/-1">
                      <div class="lbl">Adres</div>
                      <div class="val" id="cmInfoAddress">‚Äî</div>
                    </div>
                  </div>
                </div>
              </div>
              <div style="margin-top: 10px; display: flex; gap: 8px">
                <a class="btn" href="#" id="openFullCase"
                  >üîé Otw√≥rz pe≈Çny widok</a
                >
              </div>
            </div>

            <!-- EDIT -->
            <div class="tabpanel" data-panel="edit">
              <div class="grid">
                <div class="section">
                  <div class="kv">
                    <div class="item">
                      <div class="lbl">WPS (PLN)</div>
                      <input
                        id="cmWps"
                        type="number"
                        step="100"
                        min="0"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      />
                    </div>
                    <div class="item">
                      <div class="lbl">Status</div>
                      <select
                        id="cmStatus"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      >
                        <option>nowa</option>
                        <option>analiza</option>
                        <option>w toku</option>
                        <option>success</option>
                        <option>przegrana</option>
                      </select>
                    </div>
                    <div class="item">
                      <div class="lbl">Kwota kredytu</div>
                      <input
                        id="cmAmount"
                        type="number"
                        step="0.01"
                        min="0"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      />
                    </div>
                    <div class="item">
                      <div class="lbl">Bank</div>
                      <select
                        id="cmBank"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      ></select>
                    </div>
                    <div class="item">
                      <div class="lbl">Data zawarcia</div>
                      <input
                        id="cmDate"
                        type="date"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      />
                    </div>
                  </div>
                </div>
                <div class="section">
                  <div style="font-weight: 700; margin-bottom: 8px">Akcje</div>
                  <button id="cmSave" class="btn btn-primary">üíæ Zapisz</button>
                </div>
              </div>
            </div>

            <!-- OFFERS -->
            <div class="tabpanel" data-panel="offers">
              <div class="offers" id="cmOffers">≈Åadowanie propozycji‚Ä¶</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Diagnostics overlay -->
      <div id="diagnostics"></div>
    </main>

    <script src="/dashboard.js"></script>
  </body>
</html>
