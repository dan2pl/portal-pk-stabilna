  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal PK ‚Äî Dashboard 12F</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/style.css" />

    <!-- Lokalny, lekki CSS tylko dla oferty SKD -->
    <style>
      /* Czy≈õcimy t≈Ça / gradienty tylko w karcie Oferta SKD */
      #skdOffer,
      #skdOffer * {
        background-image: none !important;
      }

      #skdOffer::before,
      #skdOffer::after,
      #skdOffer .card-h::before,
      #skdOffer .card-h::after {
        content: none !important;
        background: none !important;
      }

      /* Nag≈Ç√≥wek karty Oferta SKD */
      #skdOffer .card-h {
        background: #ffffff !important;
        border-bottom: 1px solid #e6e8ec;
        padding: 10px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      #skdOffer .card-title {
        font-size: 1rem;
        font-weight: 600;
      }

      #skdOffer .card-sub {
        font-size: 0.8rem;
        color: #6b7280;
      }

      /* Uk≈Çad dw√≥ch kolumn: Wycena roszczenia (WPS) + Wariant oferty */
      #skdOffer .grid2 {
        display: grid;
        grid-template-columns: minmax(260px, 1.1fr) minmax(260px, 1.2fr);
        gap: 16px;
        align-items: flex-start;
      }

      /* Kafelkowe grupy po lewej i prawej */
      #skdOffer .group {
        background: #f9fafb;
        border-radius: 12px;
        padding: 12px 14px;
        border: 1px solid #e3e6ee;
      }

      #skdOffer .group-title {
        margin: 4px 0 10px;
        font-size: 0.9rem;
        font-weight: 600;
        color: #111827;
      }

      #skdOffer .row + .row {
        margin-top: 8px;
      }

      /* Label + input w polach liczbowych */
      #skdOffer .fld span {
        display: block;
        font-size: 0.78rem;
        color: #4b5563;
        margin-bottom: 2px;
      }

      #skdOffer .fld input {
        width: 100%;
        padding: 7px 9px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        font-size: 0.9rem;
      }

      #skdOffer .fld input:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.25);
      }

      /* Przycisk "U≈ºyj warto≈õci z WPS" */
      #skdOffer #applyWps {
        float: right;
        margin-top: 6px;
        background: #f0f3f7;
        border: 1px solid #ccd2db;
        padding: 6px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: background 0.15s ease, transform 0.05s ease;
      }

      #skdOffer #applyWps:hover {
        background: #e0e7ff;
        transform: translateY(-1px);
      }

      #skdOffer #applyWps:active {
        transform: translateY(0);
      }

      /* Notatka wewnƒôtrzna ‚Äì sp√≥jna z kafelkami */
      #skdOffer textarea {
        width: 100%;
        background: #f9fafb;
        border: 1px solid #e3e6ee;
        border-radius: 10px;
        padding: 10px;
        font-size: 0.9rem;
        resize: vertical;
      }
    </style>
  </head>


  <body data-role="admin">
    <header class="site-header">
      <div class="wrap">
        <h1>Portal PK ‚Äì Dashboard</h1>

        <!-- Search spraw (przed przyciskiem Wyloguj) -->
        <div
          id="caseSearchWrap"
          style="
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 12px;
          "
        >
          <div style="position: relative; display: flex; align-items: center">
            <input
              id="caseSearch"
              type="text"
              placeholder="Szukaj: nazwisko"
              autocomplete="off"
              style="
                height: 34px;
                padding: 0 28px 0 10px;
                border: 1px solid #d0d7de;
                border-radius: 8px;
                outline: none;
                min-width: 220px;
              "
            />
            <button
              id="clearCaseSearch"
              title="Wyczy≈õƒá"
              aria-label="Wyczy≈õƒá"
              style="
                position: absolute;
                right: 4px;
                height: 24px;
                width: 24px;
                border: none;
                background: transparent;
                cursor: pointer;
                font-size: 16px;
                line-height: 1;
              "
            >
              √ó
            </button>
          </div>
          <span
            id="caseSearchCount"
            style="font-size: 12px; color: #6c757d"
          ></span>
        </div>

        <button id="logoutBtn">üö™ Wyloguj</button>\
        <span id="currentUserLabel" style="margin-right: 16px; font-weight: 500;">
  <!-- tu wstrzykniemy z JS -->
</span>

<a
  href="admin.html"
  id="adminPanelLink"
  style="display:none; margin-right: 16px; font-weight: 500; color:#d80032; text-decoration: none;"
>
  Panel administratora
</a>
      </div>
    </header>

    <main>
      <!-- Pasek filtr√≥w -->
      <div
        id="filterBar"
        style="display: flex; gap: 8px; align-items: center; margin: 8px 0 12px"
      >
        <label for="flt_status">Status:</label>
        <select id="flt_status">
          <option value="">wszystkie</option>
          <option value="new">Nowe</option>
          <option value="in_progress">W toku</option>
          <option value="success">Analiza pozytywna</option>
          <option value="lost">Odrzucone</option>
        </select>
        <button id="flt_refresh">Od≈õwie≈º</button>
        
      </div>

      <!-- KPI ‚Äì ilo≈õci spraw -->
      <section id="kpiBar" class="kpi-bar">
        <div class="kpi-card" data-status="">
          <div class="kpi-label">Wszystkie sprawy</div>
          <div class="kpi-value" id="kpiAll">‚Äì</div>
        </div>
        <div class="kpi-card" data-status="new">
          <div class="kpi-label">Nowe</div>
          <div class="kpi-value" id="kpiNew">‚Äì</div>
        </div>
        <div class="kpi-card" data-status="success">
          <div class="kpi-label">Analiza pozytywna</div>
          <div class="kpi-value" id="kpiPositive">‚Äì</div>
        </div>
        <div class="kpi-card" data-status="in_progress">
          <div class="kpi-label">W toku</div>
          <div class="kpi-value" id="kpiInProgress">‚Äì</div>
        </div>
        <div class="kpi-card" data-status="lost">
          <div class="kpi-label">Odrzucone</div>
          <div class="kpi-value" id="kpiRejected">‚Äì</div>
        </div>
      </section>

      <!-- KPI ‚Äì WPS -->
      <section id="kpiWpsBar" class="kpi-bar" style="margin-top: 12px">
        <div class="kpi-card">
          <div class="kpi-label">Suma WPS (wszystkie) (PLN)</div>
          <div class="kpi-value" id="kpiWpsTotal">‚Äì</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Suma WPS (w toku) (PLN)</div>
          <div class="kpi-value" id="kpiWpsInProgress">‚Äì</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">≈ör. WPS na sprawƒô (w toku) (PLN)</div>
          <div class="kpi-value" id="kpiWpsAvgInProgress">‚Äì</div>
        </div>
      </section>

      <!-- Layout 2 kolumny -->
      <div class="layout">
        <!-- LEWA KOLUMNA: tabela spraw -->
        <aside class="col-left">
          <table id="caseTable">
            <thead>
              <tr>
                <th>Klient</th>
                <th>Bank</th>
                <th>Kwota kredytu</th>
                <th>WPS</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="caseTableBody"></tbody>
          </table>
        </aside>

        <!-- PRAWA KOLUMNA: dodawanie nowej sprawy -->
        <section class="col-right">
          <div class="card form-card">
            <h3 class="card-title">Dodaj nowƒÖ sprawƒô</h3>
            <div class="form-grid">
              <div class="field">
                <label for="addClient"><span>Klient</span></label>
                <input
                  id="addClient"
                  type="text"
                  placeholder="np. Jan Kowalski"
                />
              </div>
              <div class="field">
                <label for="addAmount"><span>Kwota (PLN)</span></label>
                <input
                  id="addAmount"
                  type="number"
                  min="0"
                  step="0.01"
                  placeholder="np. 25 000"
                />
              </div>
              <div class="field">
                <label for="addBank"><span>Bank</span></label>
                <select id="addBank"></select>
              </div>
              <div class="file-drop-area" id="fileDropArea">
  <div class="file-drop-message">
    üìé Upu≈õƒá tutaj pliki lub <span class="file-browse">kliknij</span>
  </div>
  <input type="file" id="addFiles" multiple hidden />
  <p class="upload-hint">
  Mo≈ºesz dodaƒá maks. 10 plik√≥w, ka≈ºdy do 20 MB.<br>
  Dozwolone formaty: PDF, JPG, PNG, DOC, XLS, TXT.<br>
  W razie du≈ºych plik√≥w u≈ºyj kompresji PDF:
  <a href="https://www.ilovepdf.com/compress_pdf" target="_blank">iLovePDF</a>
</p>

</div>

<div id="fileListPreview" class="file-list-preview"></div>


            </div>
            <input id="addStatus" type="hidden" value="nowa" />
            <div class="form-actions">
              <button id="addCaseBtn" type="button">Zapisz sprawƒô</button>
            </div>
          </div>
        </section>
      </div>

      <!-- === MODAL: Edycja sprawy === -->
      <div
        id="caseModal"
        class="modal modal-modern"
        style="display: none"
        role="dialog"
        aria-modal="true"
        aria-labelledby="cmTitle"
      >
        <div class="modal-backdrop"></div>

        <div class="modal-card modal-sheet">
          <div class="modal-header">
            <div class="title">
              <span id="cmTitle">Sprawa:</span>
              <span id="cmClient">‚Äî</span>
              <span id="cmStatusBadge" class="badge">‚Äî</span>
            </div>
            <div style="display: flex; gap: 8px; align-items: center">
              <button id="cmClose" aria-label="Zamknij" class="btn">√ó</button>
            </div>
          </div>

          <!-- ===== OFERTA SKD (sekcja) ===== -->
          <section id="skdOffer" class="card">
            <header class="card-h">
              <div>
                <div class="card-title">Oferta SKD</div>
                <div id="skdOfferSub" class="card-sub">‚Äî</div>
              </div>
              <a
  id="openFullCase"
  href="#"
  target="_blank"
  class="open-full-btn"
>
  Otw√≥rz pe≈Çny widok
</a>

              <button
                id="skdOfferSaveBtn"
                class="btn btn-primary"
                style="display: none"
              >
                Zapisz
              </button>
            </header>
<section class="card" id="wpsBasicCard">
  <header class="card-h">
    <div class="card-b">
      <div class="card-title">WPS Basic (silnik SKD)</div>
      <div class="card-sub">Szybkie wyliczenie na podstawie podstawowych danych</div>
    </div>
  </header>
  <div class="card-b">
    <input type="hidden" id="wpsCaseId" value="{{ case.id }}">
    <div class="form-grid">
      <label class="form-field">
        <span>Kwota kredytu na rƒôkƒô (netto)</span>
        <input id="wpsLoanNet" type="number" step="0.01" placeholder="np. 40000" />
      </label>

      <label class="form-field">
        <span>Kwota ca≈Çkowita umowy (brutto)</span>
        <input id="wpsLoanTotal" type="number" step="0.01" placeholder="np. 52000" />
      </label>

      <label class="form-field">
        <span>Okres kredytu (miesiƒÖce)</span>
        <input id="wpsLoanTerm" type="number" step="1" placeholder="np. 72" />
      </label>

      <label class="form-field">
        <span>Liczba zap≈Çaconych rat</span>
        <input id="wpsInstallmentsPaid" type="number" step="1" placeholder="np. 24" />
      </label>

      <label class="form-field">
        <span>Rata kredytu (pierwotna lub aktualna)</span>
        <input id="wpsInstallmentReal" type="number" step="0.01" placeholder="np. 980,50" />
      </label>
    </div>
<label class="fld small-note">
  <span>Nie znasz raty? Podaj oprocentowanie z umowy (%):</span>
  <input id="wpsInterestInput" type="number" step="0.1" placeholder="np. 10" />
</label>
    <div class="form-actions" style="margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;">
      <button id="wpsCalcBtn" class="btn btn-primary">
        Przelicz WPS (Basic)
      </button>

      <button id="wpsSaveBtn" class="btn btn-secondary" disabled>
        Zapisz WPS do sprawy
      </button>

      <button id="wpsApplyToSkdBtn" class="btn btn-secondary" disabled>
        U≈ºyj WPS w ofercie SKD
      </button>

      <div id="wpsResultBox" style="margin-left: auto; font-weight: 600;">
        WPS: <span id="wpsResultValue">‚Äî</span>
      </div>
    </div>
  </div>
</section>


            <div class="card-b">
              <!-- TABS wewnƒÖtrz oferty SKD -->
              <div class="modal-tabs">
                <div class="tab active" data-tab="summary">Podsumowanie</div>
                <div class="tab" data-tab="contract">Dane do umowy</div>
                <div class="tab" data-tab="files">Pliki</div>
              </div>

              <!-- PANEL: PODSUMOWANIE -->
              <div
                id="tab-summary"
                class="tab-panel active"
                style="margin-top: 12px"
              >
                <!-- Dostƒôpno≈õƒá wariant√≥w -->
                <div class="group" id="skdEligibilityGroup">
                  <div class="group-title">
                    Dostƒôpno≈õƒá wariant√≥w (co mo≈ºemy zaproponowaƒá)
                  </div>
                  <div class="row">
                    <label class="chk">
                      <input type="checkbox" id="eligSf50" checked />
                      <span>Success Fee 50% ‚Äî bez ryzyka</span>
                    </label>
                    <label class="chk">
                      <input type="checkbox" id="eligSf49" checked />
                      <span
                        >Success Fee 49% ‚Äî z wynagrodzeniem poczƒÖtkowym</span
                      >
                    </label>
                    <label class="chk">
                      <input type="checkbox" id="eligSell" checked />
                      <span>Sprzeda≈º roszczenia ‚Äî wyp≈Çata z g√≥ry</span>
                    </label>
                  </div>
                  <small
                    >Odznacz warianty, kt√≥re nie sƒÖ mo≈ºliwe dla tej
                    sprawy.</small
                  >
                </div>

                <!-- Preferencja klienta -->
                <div class="group" id="clientPreferenceBlock">
                  <div class="group-title">Preferencja Klienta</div>
                  <label class="radio">
                    <input type="radio" name="clientPref" value="sf50" />
                    <div><b>Success Fee 50%</b> ‚Äî bez ryzyka dla Klienta</div>
                  </label>
                  <label class="radio">
                    <input type="radio" name="clientPref" value="sf49" />
                    <div>
                      <b>Success Fee 49%</b> ‚Äî z wynagrodzeniem poczƒÖtkowym
                    </div>
                  </label>
                  <label class="radio">
                    <input type="radio" name="clientPref" value="sell" />
                    <div><b>Sprzeda≈º roszczenia</b> ‚Äî wyp≈Çata z g√≥ry</div>
                  </label>
                  <small
                    >Wybierz, kt√≥rƒÖ opcjƒÖ klient jest najbardziej
                    zainteresowany.</small
                  >
                </div>

                <!-- Wycena WPS + wariant oferty -->
                <div class="grid2">
                  <!-- Wycena roszczenia -->
                  <div class="group">
                    <div class="group-title">Wycena roszczenia (WPS)</div>

                    <div
                      style="
                        display: grid;
                        grid-template-columns: repeat(
                          auto-fit,
                          minmax(220px, 1fr)
                        );
                        gap: 16px;
                        margin-top: 10px;
                      "
                    >
                      <label class="fld">
                        <span>WPS (prognoza)</span>
                        
<input
  id="wpsForecastInput"
  name="wps_forecast"
  data-skd-field="wps_forecast"
  type="number"
  step="0.01"
  min="0"
  placeholder="np. 40 500,00"
  class="form-control"
/>

                      </label>

                      <label class="fld">
                        <span>WPS ostateczny (PLN)</span>
                        <input
                          id="wpsFinalInput"
                          type="number"
                          step="0.01"
                          min="0"
                          placeholder="np. 18 500,00"
                        />
                      </label>

                      <label class="fld">
                        <span>Anulowanie przysz≈Çych odsetek (PLN)</span>
                        <input
                          id="futureInterestInput"
                          type="number"
                          step="0.01"
                          min="0"
                          placeholder="np. 3 200,00"
                        />
                      </label>
                    </div>

                    <div style="margin-top: 12px; text-align: right">
                      <button id="applyWps">U≈ºyj warto≈õci z WPS</button>
                    </div>
                  </div>

                  <!-- Wariant oferty -->
                  <div class="group" id="skdVariantAdminGroup">
                    <div class="group-title">Wariant oferty</div>

                    <label class="radio" data-variant="sf50">
                      <input type="radio" name="skdVariant" value="sf50" />
                      <div>
                        <div>
                          <b>Op≈Çata za sukces 50/50</b> ‚Äî bez ryzyka dla Klienta
                        </div>
                        <small>
                          Rozliczenie 50/50 od WPS. Anulowanie przysz≈Çych
                          odsetek dla Klienta
                        </small>
                      </div>
                    </label>

                    <label class="radio" data-variant="sf49">
                      <input type="radio" name="skdVariant" value="sf49" />
                      <div>
                        <div>
                          <b>Wariant Zlecenie 49/51</b> ‚Äî ryzyko po stronie
                          Klienta.
                        </div>
                        <small>
                          Wynagrodzenie wstƒôpne dla po≈õrednika za zawarcie
                          umowy. Anulowanie przysz≈Çych odsetek dla Klienta
                        </small>
                      </div>
                    </label>

                    <label class="radio" data-variant="sell">
                      <input type="radio" name="skdVariant" value="sell" />
                      <div>
                        <div><b>Sprzeda≈º roszczenia</b> ‚Äî ≈õrodki z g√≥ry</div>
                        <small>
                          Ustalony procent od WPS. Wyp≈Çata dla Klienta do 14
                          dni. Anulowanie przysz≈Çych odsetek dla Klienta
                        </small>
                        <div class="row" data-extra="sell">
                          <label class="fld">
                            <span>Minimalna stawka dla Klienta 10(%)</span>
                            <input
                              id="buyoutPctInput"
                              type="number"
                              step="0.1"
                              min="10"
                              max="15"
                              value="10"
                            />
                            <div
  id="buyoutWarning"
  style="color:#d00;font-size:12px;margin-top:4px;display:none;"
>
  Wpisz warto≈õƒá miƒôdzy 10% a 15%.
</div>
                          </label>
                        </div>
                      </div>
                    </label>
                  </div>
                </div>

                <!-- Symulacja wyp≈Çat -->
                <div class="group">
                  <div class="group-title">Symulacja wyp≈Çat (szacunek)</div>
                  <div class="est">
                    <div>
                      <span>‚ÄûTeraz‚Äù (z g√≥ry): </span
                      ><strong id="estNow">‚Äî</strong>
                    </div>
                    <div>
                      <span>‚ÄûP√≥≈∫niej‚Äù (po odzyskaniu): </span
                      ><strong id="estLater">‚Äî</strong>
                    </div>
                    <div>
                      <span>Suma dla Klienta: </span
                      ><strong id="estTotal">‚Äî</strong>
                    </div>
                  </div>
                  <small>
                    Warto≈õci orientacyjne ‚Äî WPS traktujemy jako bazƒô do
                    rozlicze≈Ñ.
                  </small>
                </div>

                <!-- Notatka -->
                <div class="group">
                  <div class="group-title">Notatka (wewnƒôtrzna)</div>
                  <textarea
                    id="skdOfferNotes"
                    rows="3"
                    placeholder="np. klient preferuje sprzeda≈º roszczenia; mo≈ºliwa korekta % przy wykupie."
                  ></textarea>
                </div>
              </div>

              <!-- PANEL: DANE DO UMOWY -->
              <div
                id="tab-contract"
                class="tab-panel"
                style="display: none; margin-top: 12px"
              >
                <div class="card">
                  <div class="card-h">Dane do umowy</div>
                  <div class="card-b">
                    <div
                      style="
                        display: grid;
                        grid-template-columns: repeat(
                          auto-fit,
                          minmax(260px, 1fr)
                        );
                        gap: 16px;
                      "
                    >
                      <div>
                        <div class="group-title">Dane osobowe</div>

                        <label class="fld">
                          <span>Imiƒô i nazwisko</span>
                          <input id="contractName" type="text" />
                        </label>

                        <label class="fld" style="margin-top: 8px">
                          <span>PESEL</span>
                          <input id="contractPesel" type="text" />
                        </label>

                        <label class="fld" style="margin-top: 8px">
                          <span>Adres</span>
                          <input id="contractAddress" type="text" />
                        </label>
                      </div>

                      <div>
                        <div class="group-title">Kontakt i rozliczenia</div>

                        <label class="fld">
                          <span>Telefon</span>
                          <input id="contractPhone" type="tel" />
                        </label>

                        <label class="fld" style="margin-top: 8px">
                          <span>E-mail</span>
                          <input id="contractEmail" type="email" />
                        </label>

                        <label class="fld" style="margin-top: 8px">
                          <span>Numer konta</span>
                          <input id="contractIban" type="text" />
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- PANEL: PLIKI -->
              <div
                id="tab-files"
                class="tab-panel"
                style="display: none; margin-top: 12px"
              >
                <div class="card">
                  <div class="card-h">Pliki do sprawy</div>
                  <div class="card-b">
                    <label class="fld">
                      <span>Dodaj pliki</span>
                      <input id="caseFilesInput" type="file" multiple />
                    </label>

                    <div
                      id="caseFilesEmpty"
                      style="font-size: 0.8rem; color: #9ca3af; margin-top: 8px"
                    >
                      Brak dodanych plik√≥w.
                    </div>

                    <ul
                      id="caseFilesList"
                      style="list-style: none; padding: 0; margin-top: 6px"
                    ></ul>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <!-- ===== /OFERTA SKD ===== -->

          <div class="modal-body">
            <!-- INFO -->
            <div class="tabpanel active" data-panel="info">
              <div class="grid">
                <div class="section">
                  <div class="kv">
                    <div class="item">
                      <div class="lbl">Klient</div>
                      <div class="val" id="cmInfoClient">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">Bank</div>
                      <div class="val" id="cmInfoBank">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">Kwota kredytu</div>
                      <div class="val" id="cmInfoAmount">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">WPS</div>
                      <div class="val" id="cmInfoWps">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">Status</div>
                      <div class="val" id="cmInfoStatus">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">Data zawarcia</div>
                      <div class="val" id="cmInfoDate">‚Äî</div>
                    </div>
                  </div>
                </div>

                <div class="section">
                  <div style="font-weight: 700; margin-bottom: 8px">
                    Dane kontaktowe
                  </div>
                  <div class="kv">
                    <div class="item">
                      <div class="lbl">Telefon</div>
                      <div class="val" id="cmInfoPhone">‚Äî</div>
                    </div>
                    <div class="item">
                      <div class="lbl">E-mail</div>
                      <div class="val" id="cmInfoEmail">‚Äî</div>
                    </div>
                    <div class="item" style="grid-column: 1/-1">
                      <div class="lbl">Adres</div>
                      <div class="val" id="cmInfoAddress">‚Äî</div>
                    </div>
                  </div>
                </div>
              </div>

              <div style="margin-top: 10px; display: flex; gap: 8px">     
          </div>

<script>
  // Podczas klikniƒôcia w wiersz w tabeli zapisujemy ID sprawy jako "aktywne"
  document.getElementById("caseTableBody")?.addEventListener("click", (ev) => {
    const tr = ev.target.closest("tr");
    if (!tr) return;

    const cid = tr.getAttribute("data-id");
    if (!cid) return;

    // zapisz ID do linka
    const openBtn = document.getElementById("openFullCase");
    if (openBtn) {
      openBtn.dataset.caseId = cid;
      openBtn.href = `/cases/${cid}`;
    }
  });

  // Fallback gdy kto≈õ kliknie zanim wybierze wiersz
  document.getElementById("openFullCase")?.addEventListener("click", (ev) => {
    const link = ev.currentTarget;
    const cid = link.dataset.caseId;

    if (!cid) {
      ev.preventDefault();
      alert("Najpierw wybierz sprawƒô z listy po lewej.");
    }
  });
</script>

            <!-- EDIT -->
            <div class="tabpanel" data-panel="edit">
              <div class="grid">
                <div class="section">
                  <div class="kv">
                    <div class="item">
                      <div class="lbl">WPS (PLN)</div>
                      <input
                        id="cmWps"
                        type="number"
                        step="100"
                        min="0"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      />
                    </div>
                    <div class="item">
                      <div class="lbl">Status</div>
                      <select
                        id="cmStatus"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      >
                        <option>nowa</option>
                        <option>analiza</option>
                        <option>w toku</option>
                        <option>success</option>
                        <option>przegrana</option>
                      </select>
                    </div>
                    <div class="item">
                      <div class="lbl">Kwota kredytu</div>
                      <input
                        id="cmAmount"
                        type="number"
                        step="0.01"
                        min="0"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      />
                    </div>
                    <div class="item">
                      <div class="lbl">Bank</div>
                      <select
                        id="cmBank"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      ></select>
                    </div>
                    <div class="item">
                      <div class="lbl">Data zawarcia</div>
                      <input
                        id="cmDate"
                        type="date"
                        style="
                          width: 100%;
                          padding: 10px;
                          border: 1px solid #e5e7eb;
                          border-radius: 10px;
                        "
                      />
                    </div>
                  </div>
                </div>

                <div class="section">
                  <div style="font-weight: 700; margin-bottom: 8px">Akcje</div>
                  <button id="cmSave" class="btn btn-primary">üíæ Zapisz</button>
                </div>
              </div>
            </div>

            <!-- OFFERS -->
            <div class="tabpanel" data-panel="offers">
              <div class="offers" id="cmOffers">≈Åadowanie propozycji‚Ä¶</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Diagnostics overlay -->
      <div id="diagnostics"></div>
    </main>

    <script src="/skdEngine.js"></script>
<script src="/dashboard.js"></script>
</body>
</html>

