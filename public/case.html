<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Szczeg√≥≈Çy sprawy ‚Äì Portal PK</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Je≈õli masz ju≈º globalny CSS (np. styles.css / dashboard.css), pod≈ÇƒÖcz go tutaj -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="page">
      <!-- NAG≈Å√ìWEK SPRAWY -->
      <section class="card case-header case-card case-anim case-anim-delay-1">
        <div class="case-header-main">
          <div class="case-title">
            Sprawa <span id="caseId">#12345</span> ‚Äì
            <span id="caseClientName">Imiƒô Nazwisko</span>
          </div>
          <div class="case-subtitle">
            Utworzono: <span id="caseCreatedAt">01.10.2025</span> ¬∑ ProwadzƒÖcy:
            <span id="caseOwner">Jan Kowalski</span>
          </div>
          <input type="hidden" id="caseIdValue" />
          <div class="case-tags">
            <span class="tag tag-primary" id="caseStatus">NOWA</span>
            <span class="tag" id="caseBank">mBank</span>
            <span class="tag" id="caseProductType">Kredyt got√≥wkowy</span>
            <span class="tag tag-success" id="caseSkdTag">SKD aktywna</span>
          </div>
        </div>
        <div class="case-actions">
          <button class="btn btn-outline case-btn" id="btnBack">Powr√≥t</button>
          <button class="btn btn-primary case-btn" id="btnSaveAll">
            Zapisz zmiany
          </button>
          <button
            id="deleteCaseBtn"
            class="btn btn-danger case-btn"
            type="button"
            style="margin-left: 8px"
          >
            Usu≈Ñ sprawƒô
          </button>
        </div>
      </section>

      <section class="case-layout">
        <!-- LEWY SIDEBAR -->
        <aside class="case-sidebar">
          <div class="card case-card case-anim case-anim-delay-1">
            <div class="case-sidebar-section-title">Podsumowanie finansowe</div>
            <div class="case-sidebar-row">
              <span class="case-sidebar-label">Kwota kredytu</span>
              <span class="case-sidebar-value" id="summaryAmount"
                >50 000 z≈Ç</span
              >
            </div>
            <div class="case-sidebar-row">
              <span class="case-sidebar-label">Ca≈Çkowity koszt</span>
              <span class="case-sidebar-value" id="summaryTotalCost"
                >20 000 z≈Ç</span
              >
            </div>
            <div class="case-sidebar-row">
              <span class="case-sidebar-label">Potencja≈Ç SKD</span>
              <span class="case-sidebar-value" id="summarySkdPotential"
                >18 500 z≈Ç</span
              >
            </div>
            <div class="case-sidebar-row">
              <span class="case-sidebar-label">WPS (prognoza)</span>
              <span class="case-sidebar-value" id="summaryWps">
                12 300 z≈Ç
              </span>
            </div>
          </div>

          <div class="card case-details case-card case-anim case-anim-delay-2">
            <div class="case-sidebar-section-title">Status sprawy</div>
            <div class="case-sidebar-row">
              <span class="case-sidebar-label">Etap</span>
              <span class="case-sidebar-value" id="summaryStage">
                Analiza
              </span>
            </div>
            <div class="case-sidebar-row">
              <span class="case-sidebar-label">Status SKD</span>
              <span class="case-sidebar-value" id="summarySkdStatus">
                W przygotowaniu
              </span>
            </div>
            <div class="case-sidebar-row">
              <span class="case-sidebar-label">Ostatnia zmiana</span>
              <span class="case-sidebar-value" id="summaryLastUpdate">
                21.11.2025
              </span>
            </div>
            <div
              class="case-sidebar-section-title"
              style="margin-top: 10px; margin-bottom: 4px"
            >
              Postƒôp sprawy
            </div>
            <div class="case-progress-bar">
              <div
                id="caseProgressFill"
                class="case-progress-fill"
                aria-label="Postƒôp sprawy"
              ></div>
            </div>
          </div>
        </aside>

        <!-- PRAWA STRONA: TABS + PANELS -->
        <main class="card case-card case-anim case-anim-delay-2">
          <!-- TABS -->
          <div class="case-tabs" id="caseTabs">
            <button class="case-tab active" data-tab="client">
              Dane klienta
            </button>
            <button class="case-tab" data-tab="credit">Dane kredytu</button>
            <button class="case-tab" data-tab="skd">SKD</button>
            <button class="case-tab" data-tab="decision">Decyzja</button>
            <button class="case-tab" data-tab="docs">Dokumenty</button>
            <button class="case-tab" data-tab="notes">Notatki</button>
            <button class="case-tab" data-tab="emails">E-maile</button>
            <button class="case-tab" data-tab="history">Historia zmian</button>
          </div>

          <!-- PANELS -->
          <div class="tab-panels">
            <!-- PANEL: DANE KLIENTA -->
            <section
              class="tab-panel active case-anim case-anim-delay-1"
              data-tab-panel="client"
              id="panelClient"
            >
              <div class="accordion">
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">Dane podstawowe</div>
                    <div class="accordion-toggle">‚ñ∂</div>
                  </div>
                  <div class="accordion-body">
                    <div class="field-row">
                      <div class="field">
                        <label for="clientName">Imiƒô i nazwisko</label>
                        <input type="text" id="clientName" autocomplete="off" />
                      </div>
                      <div class="field">
                        <label for="clientPesel">PESEL</label>
                        <input
                          type="text"
                          id="clientPesel"
                          autocomplete="off"
                        />
                      </div>
                      <div class="field">
                        <label for="clientPhone">Telefon</label>
                        <input
                          type="text"
                          id="clientPhone"
                          autocomplete="off"
                        />
                      </div>
                      <div class="field">
                        <label for="clientEmail">E-mail</label>
                        <input
                          type="email"
                          id="clientEmail"
                          autocomplete="off"
                        />
                      </div>
                    </div>

                    <div class="field-row">
                      <div class="field">
                        <label for="clientCity">Miasto</label>
                        <input type="text" id="clientCity" autocomplete="off" />
                      </div>
                      <div class="field">
                        <label for="clientPostcode">Kod pocztowy</label>
                        <input
                          type="text"
                          id="clientPostcode"
                          autocomplete="off"
                        />
                      </div>
                      <div class="field">
                        <label for="clientStreet">Ulica i nr</label>
                        <input
                          type="text"
                          id="clientStreet"
                          autocomplete="off"
                        />
                      </div>
                    </div>
                    <div class="field-row">
                      <div class="field">
                        <label for="contractIban"
                          >Numer konta klienta (do umowy)</label
                        >
                        <input
                          type="text"
                          id="contractIban"
                          autocomplete="off"
                        />
                      </div>
                    </div>

                    <div class="section-actions">
                      <button
                        class="btn btn-outline case-btn"
                        id="btnClientCancel"
                      >
                        Anuluj
                      </button>
                      <button
                        class="btn btn-primary case-btn"
                        id="btnClientSave"
                      >
                        Zapisz dane klienta
                      </button>
                    </div>
                  </div>
                </div>

                <div class="accordion-item">
                  <div class="accordion-header">
                    <div class="accordion-title">Dodatkowe informacje</div>
                    <div class="accordion-toggle">‚ñ∂</div>
                  </div>
                  <div class="accordion-body">
                    <div class="field">
                      <label for="clientNotes">Uwagi o kliencie</label>
                      <textarea id="clientNotes"></textarea>
                    </div>
                    <div class="section-actions">
                      <button class="btn btn-outline" id="btnClientNotesCancel">
                        Anuluj
                      </button>
                      <button class="btn btn-primary" id="btnClientNotesSave">
                        Zapisz uwagi
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PANEL: DANE KREDYTU -->
            <section
              class="tab-panel case-anim case-anim-delay-2"
              data-tab-panel="credit"
              id="panelCredit"
            >
              <div class="accordion">
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">Parametry kredytu</div>
                    <div class="accordion-toggle">‚ñ∂</div>
                  </div>
                  <div class="accordion-body">
                    <div class="field-row">
                      <div class="field">
                        <label for="creditBank">Bank</label>
                        <input type="text" id="creditBank" />
                      </div>
                      <div class="field">
                        <label for="creditProduct">Produkt</label>
                        <input type="text" id="creditProduct" />
                      </div>
                      <div class="field">
                        <label for="creditAmount">Kwota kredytu</label>
                        <input type="number" id="creditAmount" />
                      </div>
                      <div class="field">
                        <label for="creditTotalCost">Ca≈Çkowity koszt</label>
                        <input type="number" id="creditTotalCost" />
                      </div>
                    </div>

                    <div class="field-row">
                      <div class="field">
                        <label for="creditStartDate">Data uruchomienia</label>
                        <input type="date" id="creditStartDate" />
                      </div>
                      <div class="field">
                        <label for="creditEndDate">Data zako≈Ñczenia</label>
                        <input type="date" id="creditEndDate" />
                      </div>
                      <div class="field">
                        <label for="creditInstallment"> Miesiƒôczna rata </label>
                        <input type="number" id="creditInstallment" />
                      </div>
                    </div>

                    <div class="section-actions">
                      <button class="btn btn-outline" id="btnCreditCancel">
                        Anuluj
                      </button>
                      <button class="btn btn-primary" id="btnCreditSave">
                        Zapisz dane kredytu
                      </button>
                    </div>
                  </div>
                </div>

                <div class="accordion-item">
                  <div class="accordion-header">
                    <div class="accordion-title">Uwagi do umowy</div>
                    <div class="accordion-toggle">‚ñ∂</div>
                  </div>
                  <div class="accordion-body">
                    <div class="field">
                      <label for="creditNotes">Uwagi</label>
                      <textarea id="creditNotes"></textarea>
                    </div>
                    <div class="section-actions">
                      <button class="btn btn-outline" id="btnCreditNotesCancel">
                        Anuluj
                      </button>
                      <button class="btn btn-primary" id="btnCreditNotesSave">
                        Zapisz uwagi
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PANEL: SKD -->
            <section
              class="tab-panel case-anim case-anim-delay-3"
              data-tab-panel="skd"
              id="panelSkd"
            >
              <div class="accordion">
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">
                      <div class="field-row">
                        <!-- Status SKD ‚Äì na razie tylko informacyjny (podsumowanie) -->
                        <div class="field">
                          <label>Status SKD</label>
                          <div id="skdStatusLabel">
                            <!-- Tu JS wstawi tekst typu "W procesie" / "SKD uznane" -->
                          </div>
                        </div>

                        <!-- G≈Å√ìWNY etap sprawy ‚Äì spiƒôty z status_code -->
                        <div class="field">
                          <label for="caseStage">Etap sprawy</label>
                          <select id="caseStage">
                            <option value="NEW">Nowa</option>
                            <option value="ANALYSIS">W analizie</option>
                            <option value="ANALYSIS_DOCS_NEEDED">
                              Braki dokument√≥w do analizy
                            </option>
                            <option value="ANALYSIS_POSITIVE">
                              Analiza pozytywna
                            </option>
                            <option value="ANALYSIS_NEGATIVE">
                              Odrzucona w analizie
                            </option>
                            <option value="CONTRACT_PREP">
                              Przygotowanie umowy
                            </option>
                            <option value="CONTRACT_DOCS_NEEDED">
                              Oczekiwanie na dokumenty do wykupu
                            </option>
                            <option value="CONTRACT_AT_AGENT">
                              Umowa u agenta
                            </option>
                            <option value="CONTRACT_SIGNED">
                              Umowa zawarta
                            </option>
                            <option value="IN_PROGRESS">W toku</option>
                            <option value="CLOSED_SUCCESS">
                              Zako≈Ñczona ‚Äì Sukces
                            </option>
                            <option value="CLOSED_FAIL">
                              Zako≈Ñczona ‚Äì Przegrana
                            </option>
                            <option value="CLIENT_RESIGNED">
                              Rezygnacja klienta
                            </option>
                          </select>
                        </div>
                      </div>

                      <div class="field">
                        <label for="skdDate">Data wys≈Çania SKD</label>
                        <input type="date" id="skdDate" />
                      </div>
                      <div class="field">
                        <label for="skdPotential">Potencja≈Ç SKD (szac.)</label>
                        <input type="number" id="skdPotential" />
                      </div>
                    </div>

                    <div class="field-row">
                      <div class="field">
                        <label for="skdWpsForecast">Prognoza WPS</label>
                        <input type="number" id="skdWpsForecast" />
                      </div>
                      <div class="field">
                        <label for="skdOfferVariant">Wariant oferty</label>
                        <select id="skdOfferVariant">
                          <option value="prosty">Prosty</option>
                          <option value="standard">Standard</option>
                          <option value="premia">
                            Premia / wyp≈Çata z g√≥ry
                          </option>
                        </select>
                      </div>
                    </div>

                    <div class="section-actions">
                      <button class="btn btn-outline" id="btnSkdCancel">
                        Anuluj
                      </button>
                      <button class="btn btn-primary" id="btnSkdSave">
                        Zapisz dane SKD
                      </button>
                    </div>
                  </div>
                </div>

                <div class="accordion-item">
                  <div class="accordion-header">
                    <div class="accordion-title">Oferta dla klienta</div>
                    <div class="accordion-toggle">‚ñ∂</div>
                  </div>
                  <div class="accordion-body">
                    <div class="field-row">
                      <div class="field">
                        <label for="skdOfferText"
                          >Tre≈õƒá oferty / ustalenia</label
                        >
                        <textarea id="skdOfferText"></textarea>
                      </div>
                    </div>
                    <div class="section-actions">
                      <button class="btn btn-outline" id="btnSkdOfferCancel">
                        Anuluj
                      </button>
                      <button class="btn btn-primary" id="btnSkdOfferSave">
                        Zapisz ofertƒô
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!--DECYZJA-->
            <section
              class="tab-panel case-anim case-anim-delay-4"
              data-tab-panel="decision"
              id="paneDecision"
            >
              <div class="accordion">
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">Deklaracja / dokumenty</div>
                  </div>

                  <div class="accordion-body">
                    <div class="field-grid">
                      <div class="field">
                        <label>Wybrany wariant</label>
                        <div id="decisionVariant" class="pill">‚Äî</div>
                      </div>

                      <div class="field">
                        <label>Status dokument√≥w</label>
                        <div id="decisionDocs" class="checklist">
                          <!-- wype≈Çni JS -->
                        </div>
                      </div>
                    </div>

                    <div
                      class="section-actions"
                      style="
                        display: flex;
                        gap: 0.5rem;
                        flex-wrap: wrap;
                        margin-top: 12px;
                      "
                    >
                      <button
                        class="btn btn-primary"
                        id="btnDecisionPrimary"
                        disabled
                      >
                        ‚Äî
                      </button>
                      <button class="btn btn-outline" id="btnDecisionRefresh">
                        Od≈õwie≈º
                      </button>

                      <button
                        id="btnDecisionChangeOffer"
                        class="btn btn-secondary"
                      >
                        Zmie≈Ñ ofertƒô (SKD)
                      </button>
                    </div>

                    <div
                      class="small-note"
                      id="decisionHint"
                      style="margin-top: 8px; opacity: 0.8"
                    ></div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PANEL: DOKUMENTY -->
            <section
              class="tab-panel case-anim case-anim-delay-2"
              data-tab-panel="docs"
              id="panelDocs"
            >
              <div class="accordion">
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">Lista dokument√≥w</div>
                    <div class="accordion-toggle">‚ñ∂</div>
                  </div>
                  <div class="accordion-body">
                    <!-- === DOKUMENTY ‚Äì PREMIUM (dopasowane do accordion) === -->
                    <div id="documentsSection">
                      <!-- Drag & Drop -->
                      <div class="file-drop-area" id="caseFileDropArea">
                        <div class="upload-hint">
                          üìÑ <strong>Obs≈Çugiwane formaty:</strong> PDF, JPG,
                          PNG, DOC, XLS, TXT <br />üì∏
                          <strong>Uwaga:</strong> Zdjƒôcia z iPhone w formacie
                          HEIC/HEIF nie sƒÖ obs≈Çugiwane ‚Äî w razie potrzeby zmie≈Ñ
                          format aparatu na JPG lub u≈ºyj opcji ‚ÄûZapisz jako
                          PDF‚Äù.
                        </div>
                        <div class="file-drop-message">
                          üìé Upu≈õƒá tutaj pliki lub
                          <span class="file-browse">kliknij</span>, aby dodaƒá
                          dokumenty
                        </div>
                        <div class="file-doc-type">
                          <label for="caseFileDocKey">
                            Typ dodawanego dokumentu:
                          </label>
                          <select id="caseFileDocKey">
                            <option value="">‚Äî wybierz typ dokumentu ‚Äî</option>
                            <option value="credit_agreement">
                              Umowa kredytowa
                            </option>
                            <option value="schedule">Harmonogram</option>
                            <option value="certificate">
                              Za≈õwiadczenie z banku
                            </option>
                            <option value="bik_report">Raport BIK</option>
                            <option value="other">Inny dokument</option>
                          </select>
                        </div>
                        <input type="file" id="caseAddFiles" multiple hidden />
                        <p class="upload-hint">
                          Mo≈ºesz dodaƒá maks. 10 plik√≥w, ka≈ºdy do 20 MB.<br />
                          Dozwolone formaty: PDF, JPG, PNG, DOC, XLS, TXT.<br />
                          W razie du≈ºych plik√≥w u≈ºyj kompresji PDF:
                          <a
                            href="https://www.ilovepdf.com/compress_pdf"
                            target="_blank"
                            >iLovePDF</a
                          >
                        </p>
                      </div>

                      <!-- Lista dokument√≥w -->
                      <div id="caseFileList" class="file-list-wrapper">
                        <div class="file-list-empty">
                          Brak plik√≥w w tej sprawie
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PANEL: NOTATKI -->
            <section
              class="tab-panel case-anim case-anim-delay-3"
              data-tab-panel="notes"
              id="panelNotes"
            >
              <div class="accordion">
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">Notatki wewnƒôtrzne</div>
                    <div class="accordion-toggle">‚ñ∂</div>
                  </div>
                  <div class="accordion-body">
                    <div class="field">
                      <label for="caseNotes">Notatki</label>
                      <textarea id="caseNotes"></textarea>
                    </div>
                    <div class="section-actions">
                      <button class="btn btn-outline" id="btnCaseNotesCancel">
                        Anuluj
                      </button>
                      <button class="btn btn-primary" id="btnCaseNotesSave">
                        Zapisz notatki
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!--PANEL E-MAIL-->
            <section
              class="tab-panel case-anim case-anim-delay-4"
              data-tab-panel="emails"
              id="panelEmails"
            >
              >
              <div class="accordion">
                <!-- FORMULARZ WYSY≈ÅKI -->
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">Wy≈õlij e-mail</div>
                    <div class="accordion-toggle">‚ñº</div>
                  </div>
                  <div class="accordion-body">
                    <div class="field">
                      <label for="caseEmailTo"
                        >Adres e-mail klienta / agenta</label
                      >
                      <input
                        id="caseEmailTo"
                        type="email"
                        placeholder="np. jan.kowalski@example.com"
                      />
                    </div>

                    <div class="field">
                      <label for="caseEmailBody">Tre≈õƒá wiadomo≈õci</label>
                      <textarea
                        id="caseEmailBody"
                        placeholder="Wpisz tre≈õƒá wiadomo≈õci..."
                      ></textarea>
                    </div>

                    <div class="section-actions">
                      <button class="btn btn-primary" id="caseEmailSendBtn">
                        Wy≈õlij wiadomo≈õƒá
                      </button>
                      <span id="caseEmailSendStatus" class="hint"></span>
                    </div>
                  </div>
                </div>

                <!-- HISTORIA MAILI -->
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">
                      Historia e-maili w sprawie
                    </div>
                    <div class="accordion-toggle">‚ñº</div>
                  </div>
                  <div class="accordion-body">
                    <div id="caseEmailList" class="case-email-list">
                      ≈Åadowanie‚Ä¶
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PANEL: HISTORIA ZMIAN -->
            <section
              class="tab-panel case-anim case-anim-delay-4"
              data-tab-panel="history"
              id="panelHistory"
            >
              <div class="accordion">
                <div class="accordion-item open">
                  <div class="accordion-header">
                    <div class="accordion-title">O≈õ czasu zmian</div>
                    <div class="accordion-toggle">‚ñ∂</div>
                  </div>
                  <div class="accordion-body">
                    <!-- Tu w Etapie 14C pod≈ÇƒÖczymy historiƒô z bazy -->
                    <div class="case-history-list" id="caseHistoryList">
                      <!-- Na razie mock ‚Äì p√≥≈∫niej podmienimy na dane z API -->
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </main>
      </section>
    </div>
    <script src="/wibor3m.js"></script>
    <script src="/case-page.js"></script>
  </body>
</html>
